%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#6366f1', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4f46e5', 'lineColor': '#94a3b8', 'secondaryColor': '#f1f5f9', 'tertiaryColor': '#e0e7ff'}}}%%
flowchart TB
    subgraph INPUT["ğŸ“¥ è¾“å…¥é˜¶æ®µ"]
        A[/"ğŸµ åŸå§‹éŸ³é¢‘æ–‡ä»¶"/]
        B["âš™ï¸ ç”¨æˆ·å‚æ•°<br/>åŸºå‡†å€é€Ÿ R<br/>é«˜å¯†åº¦å› å­ Î±<br/>ä½å¯†åº¦å› å­ Î²"]
    end

    subgraph VAD["ğŸ¤ ç¬¬ä¸€å±‚: VAD åˆ†æ"]
        C["Silero-VAD æ¨¡å‹"]
        D["é€å¸§è®¡ç®—è¯­éŸ³æ¦‚ç‡<br/>(32ms çª—å£)"]
        E[/"æ¦‚ç‡åºåˆ—<br/>[0.1, 0.8, 0.9, 0.2, ...]"/]
    end

    subgraph SEGMENT["ğŸ“Š ç¬¬äºŒå±‚: å¯†åº¦åˆ†çº§"]
        F{"æ¦‚ç‡é˜ˆå€¼åˆ¤æ–­"}
        G["ğŸ”´ é«˜å¯†åº¦è¯­éŸ³<br/>prob > 0.7"]
        H["ğŸŸ¡ ä½å¯†åº¦è¯­éŸ³<br/>0.3 < prob â‰¤ 0.7"]
        I["âšª é™éŸ³<br/>prob â‰¤ 0.3"]
        J[/"ç‰‡æ®µåˆ—è¡¨<br/>[{type, start, end}, ...]"/]
    end

    subgraph SPEED["âš¡ ç¬¬ä¸‰å±‚: é€Ÿåº¦è®¡ç®— (æ™®é€šæ¨¡å¼)"]
        K["è®¡ç®—è¯­éŸ³é€Ÿåº¦<br/>v_h = R Ã— Î±<br/>v_l = R Ã— Î²"]
        L["è®¡ç®—è¯­éŸ³å¤„ç†åæ—¶é•¿<br/>T'_h = T_h / v_h<br/>T'_l = T_l / v_l"]
        M["è®¡ç®—é™éŸ³ç›®æ ‡æ—¶é•¿<br/>T'_s = T_target - T'_h - T'_l"]
        N["åæ¨é™éŸ³é€Ÿåº¦<br/>v_s = T_s / T'_s"]
        O{{"ğŸ’¡ æ ¸å¿ƒç‰¹ç‚¹:<br/>é™éŸ³è¢«å¤§å¹…å‹ç¼©<br/>ä¸ºè¯­éŸ³è…¾å‡ºæ—¶é—´"}}
    end

    subgraph PROCESS["ğŸ”§ ç¬¬å››å±‚: éŸ³é¢‘å¤„ç†"]
        P["éå†æ¯ä¸ªç‰‡æ®µ"]
        Q["åˆ‡å‰²éŸ³é¢‘å— Chunk"]
        R["å½’ä¸€åŒ– int â†’ float<br/>(-32768~32767) â†’ (-1~1)"]
        S["pyrubberband å˜é€Ÿ<br/>(WSOLA ç®—æ³•)"]
        T["åå½’ä¸€åŒ– float â†’ int"]
        U["æ‹¼æ¥æ‰€æœ‰ç‰‡æ®µ"]
    end

    subgraph OUTPUT["ğŸ“¤ è¾“å‡ºé˜¶æ®µ"]
        V["åº”ç”¨è´¨é‡é…ç½®<br/>(é‡‡æ ·ç‡/ä½æ·±/æ ¼å¼)"]
        W[/"ğŸµ è¾“å‡ºéŸ³é¢‘æ–‡ä»¶"/]
    end

    A --> C
    B --> K
    C --> D --> E
    E --> F
    F --> G & H & I
    G & H & I --> J
    J --> K
    K --> L --> M --> N
    N --> O
    O --> P
    P --> Q --> R --> S --> T --> U
    U --> V --> W

    style A fill:#6366f1,stroke:#4f46e5,color:#fff
    style W fill:#10b981,stroke:#059669,color:#fff
    style O fill:#fbbf24,stroke:#f59e0b,color:#000
    style G fill:#ef4444,stroke:#dc2626,color:#fff
    style H fill:#f59e0b,stroke:#d97706,color:#fff
    style I fill:#94a3b8,stroke:#64748b,color:#fff
