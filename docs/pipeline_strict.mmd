%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#6366f1', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4f46e5', 'lineColor': '#94a3b8', 'secondaryColor': '#f1f5f9', 'tertiaryColor': '#e0e7ff'}}}%%
flowchart TB
    subgraph INPUT["ğŸ“¥ è¾“å…¥é˜¶æ®µ"]
        A[/"ğŸµ åŸå§‹éŸ³é¢‘æ–‡ä»¶"/]
        B["âš™ï¸ ç”¨æˆ·å‚æ•°<br/>åŸºå‡†å€é€Ÿ R<br/>é«˜å¯†åº¦å› å­ Î±<br/>ä½å¯†åº¦å› å­ Î²<br/>âœ… ä¸¥æ ¼ç›¸å¯¹ä½ç½®æ¨¡å¼"]
    end

    subgraph VAD["ğŸ¤ ç¬¬ä¸€å±‚: VAD åˆ†æ"]
        C["Silero-VAD æ¨¡å‹"]
        D["é€å¸§è®¡ç®—è¯­éŸ³æ¦‚ç‡<br/>(32ms çª—å£)"]
        E[/"æ¦‚ç‡åºåˆ—<br/>[0.1, 0.8, 0.9, 0.2, ...]"/]
    end

    subgraph SEGMENT["ğŸ“Š ç¬¬äºŒå±‚: å¯†åº¦åˆ†çº§"]
        F{"æ¦‚ç‡é˜ˆå€¼åˆ¤æ–­"}
        G["ğŸ”´ é«˜å¯†åº¦è¯­éŸ³<br/>prob > 0.7"]
        H["ğŸŸ¡ ä½å¯†åº¦è¯­éŸ³<br/>0.3 < prob â‰¤ 0.7"]
        I["âšª é™éŸ³<br/>prob â‰¤ 0.3"]
        J[/"ç‰‡æ®µåˆ—è¡¨<br/>[{type, start, end}, ...]"/]
    end

    subgraph SPEED["âš¡ ç¬¬ä¸‰å±‚: é€Ÿåº¦è®¡ç®— (ä¸¥æ ¼æ¨¡å¼)"]
        K["åˆå§‹åŒ–æ‰€æœ‰é€Ÿåº¦ä¸º R<br/>v_h = v_l = v_s = R"]
        L["éå†è¯­éŸ³ç‰‡æ®µ"]
        M{"æ£€æŸ¥å‰åæ˜¯å¦æœ‰<br/>å¯å€Ÿç”¨çš„é™éŸ³?"}
        N["è®¡ç®—å¯å€Ÿç”¨æ—¶é—´<br/>time_borrow = min(å¯ç”¨, éœ€è¦)"]
        O["è°ƒæ•´è¯­éŸ³é€Ÿåº¦<br/>v_h = R Ã— Î± (ç•¥æ…¢)"]
        P["è°ƒæ•´é™éŸ³é€Ÿåº¦<br/>v_s = R Ã— (1 + Î´) (ç•¥å¿«)"]
        Q["ä¿æŒåŸé€Ÿåº¦<br/>v = R"]
        R{{"ğŸ’¡ æ ¸å¿ƒç‰¹ç‚¹:<br/>è¯­éŸ³ä¸­ç‚¹ä½ç½®ä¸¥æ ¼æŒ‰ R ç¼©æ”¾<br/>é¦–å°¾é™éŸ³æ¯”ä¾‹ä¿æŒ"}}
    end

    subgraph PROCESS["ğŸ”§ ç¬¬å››å±‚: éŸ³é¢‘å¤„ç†"]
        S["éå†æ¯ä¸ªç‰‡æ®µ"]
        T["åˆ‡å‰²éŸ³é¢‘å— Chunk"]
        U["å½’ä¸€åŒ– int â†’ float<br/>(-32768~32767) â†’ (-1~1)"]
        V["pyrubberband å˜é€Ÿ<br/>(WSOLA ç®—æ³•)"]
        W["åå½’ä¸€åŒ– float â†’ int"]
        X["æ‹¼æ¥æ‰€æœ‰ç‰‡æ®µ"]
    end

    subgraph OUTPUT["ğŸ“¤ è¾“å‡ºé˜¶æ®µ"]
        Y["åº”ç”¨è´¨é‡é…ç½®<br/>(é‡‡æ ·ç‡/ä½æ·±/æ ¼å¼)"]
        Z[/"ğŸµ è¾“å‡ºéŸ³é¢‘æ–‡ä»¶<br/>âœ… éŸ³ç”»åŒæ­¥"/]
    end

    A --> C
    B --> K
    C --> D --> E
    E --> F
    F --> G & H & I
    G & H & I --> J
    J --> K --> L
    L --> M
    M -->|æ˜¯| N --> O --> P
    M -->|å¦| Q
    O & P & Q --> R
    R --> S
    S --> T --> U --> V --> W --> X
    X --> Y --> Z

    style A fill:#6366f1,stroke:#4f46e5,color:#fff
    style Z fill:#10b981,stroke:#059669,color:#fff
    style R fill:#06b6d4,stroke:#0891b2,color:#fff
    style G fill:#ef4444,stroke:#dc2626,color:#fff
    style H fill:#f59e0b,stroke:#d97706,color:#fff
    style I fill:#94a3b8,stroke:#64748b,color:#fff
    style B fill:#8b5cf6,stroke:#7c3aed,color:#fff
